# Fish Reports Processing System
Система обработки отчетов о рыбе для Министерства здравоохранения Израиля.

## Описание
Приложение предназначено для:
1. Фильтрации данных из исходных файлов Excel
2. Конвертации весов из граммов в килограммы
3. Группировки данных по базовому документу (אסמכתת בסיס)
4. Создания промежуточных файлов с отфильтрованными данными
5. Интеллектуального поиска отчетов по содержимому файлов
6. Поиска файлов отчетов, содержащих номера лицензий клиентов
7. Замены данных в найденных отчетах
8. Подготовки копий для отправки в משרד הבריאות

## 🚀 Быстрый запуск

### Основной способ запуска:
```bash
cd src
python -m fish_reports
```

Или одной командой:
```bash
cd src ; python -m fish_reports
```

### Альтернативный запуск:
```bash
python main.py
```

## Основные функции

### Обработка данных
- **Фильтрация данных**: удаление записей с отрицательными значениями
- **Конвертация весов**: автоматическое преобразование граммов в килограммы
- **Группировка**: объединение данных по базовому документу с суммированием весов и количества

### Интеллектуальный поиск отчетов
- **Поиск по содержимому**: система анализирует содержимое файлов для поиска номеров лицензий
- **Поддержка Hebrew**: обработка полей на иврите, включая "ח"פ לקוח או מספר עוסק"
- **Множественные кодировки**: UTF-8, Windows-1255, ISO-8859-8, CP1255
- **Форматы файлов**: Excel (.xlsx, .xlsm)
- **Fallback механизм**: поиск по именам файлов, если поиск по содержимому не даст результатов
- **Замена данных**: автоматическая замена полей в найденных отчетах

### GUI интерфейс
- **Hebrew текст**: полная поддержка иврита в интерфейсе
- **Выбор папок**: интуитивный выбор исходных файлов и папок отчетов
- **Прогресс выполнения**: отслеживание хода обработки
- **Логирование**: детальные логи операций

## Структура проекта
```
fish-reports-dolina/
├── src/
│   └── fish_reports/
│       ├── core/          # Основная логика
│       │   └── workflow.py
│       ├── data/          # Обработка данных
│       │   ├── file_processor.py
│       │   └── report_manager.py
│       ├── gui/           # Интерфейс пользователя
│       │   └── main_window.py
│       └── utils/         # Вспомогательные утилиты
│           └── file_utils.py
├── tests/                 # Тесты
│   ├── conftest.py
│   └── test_file_processor.py
├── sample_data/           # Примеры данных
├── requirements.txt       # Зависимости
├── pyproject.toml         # Конфигурация проекта
└── README.md
```

## Установка
1. Создайте виртуальное окружение:
```bash
python -m venv venv
```

2. Активируйте виртуальное окружение:
```bash
# Windows
venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Использование

### 🔧 API использования
```python
from pathlib import Path
from fish_reports.core.workflow import FishReportsWorkflow

# Инициализация
workflow = FishReportsWorkflow()

# Установка путей
source_file = Path("path/to/source.xlsx")
intermediate_dir = Path("path/to/intermediate")
reports_dir = Path("path/to/reports")
output_dir = Path("path/to/output")

workflow.set_paths(source_file, intermediate_dir, reports_dir, output_dir)

# Обработка
if workflow.process_files():
    results = workflow.get_results()
    print(f"Обработано: {results['total_rows']} строк")
```

### Формат промежуточного файла Excel
Промежуточный файл должен содержать столбцы:
- `ח"פ לקוח או מספר עוסק` - номер лицензии
- `אסמכתת בסיס` - базовая ссылка
- `סה'כ אריזות` - общее количество упаковок
- `סה'כ משקל` - общий вес
- `שם כרטיס` - имя клиента
- `שם לועזי` - иностранное имя
- `כתובת` - адрес

### Пример поиска отчетов
Система ищет в файлах отчетов Hebrew поля, содержащие номера лицензий:
```
ח"פ לקוח או מספר עוסק: 12345
מספר עוסק מורשה: 67890
```

Найденные отчеты копируются в папку output с заменой данных.

## Разработка

### Статус разработки
✅ **ГОТОВО К ПРОДАКШЕНУ**

**Реализованные функции:**
- ✅ Загрузка и обработка Excel файлов
- ✅ Фильтрация отрицательных значений
- ✅ Конвертация весов (граммы → килограммы)
- ✅ Группировка данных по базовому документу
- ✅ Интеллектуальный поиск отчетов по содержимому
- ✅ Поддержка множественных кодировок
- ✅ Обработка Hebrew полей в отчетах
- ✅ Замена данных в скопированных отчетах
- ✅ Детальное логирование операций
- ✅ Сохранение промежуточных файлов

### Тестирование
```bash
# Запуск тестов
pytest tests/

# Запуск конкретного теста
pytest tests/test_file_processor.py
```

## Требования
- Python 3.8+
- pandas (для обработки данных)
- openpyxl (для работы с Excel файлами)
- pytest (для тестирования)

---

**Система протестирована и готова к использованию! ✅**

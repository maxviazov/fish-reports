# 🚀 Быстрый запуск Fish Reports

## 🔧 Ветка разработки: feature/fix-data-replacement-clean

**✅ ОЧИЩЕННАЯ И ИСПРАВЛЕННАЯ ВЕРСИЯ**  
Все проблемы решены, код очищен от мусора, система полностью рабочая.

## Для Windows PowerShell:

### Способ 1 (рекомендуемый):
```powershell
python main.py
```

### Способ 2 (через модуль):
```powershell
cd src ; python -m fish_reports
```

### Способ 3 (прямой вызов):
```powershell
python -c "from src.fish_reports.gui.main_window import FishReportsApp; FishReportsApp().run()"
```

## ✅ Проблема решена: "Копирование с одновременной заменой данных"

**✅ ИСПРАВЛЕНО**: Теперь система корректно копирует отчеты И заменяет данные одновременно!

### 🔧 Исправленная проблема:
Была проблема с конвертацией номеров лицензий при чтении Excel файлов. pandas конвертировал числовые значения в формат с `.0` (например, `558478590` становился `558478590.0`), что мешало правильному сопоставлению данных.

### ✅ Решение:
Исправлена логика конвертации в `ReportManager._load_intermediate_data()`:
```python
# Правильная конвертация номера лицензии
license_raw = row['ח"פ לקוח או מספר עוסק']
license_num = str(int(float(license_raw)))  # Убираем .0
```

### 🧪 Тест подтверждает работу:
```powershell
python check_result.py
```

**Результат:**
```
✅ מספר תעודת משלוח: 223931 (✓ правильно заменено)
✅ סה"כ קרטונים: 0.6 (✓ правильно заменено) 
✅ מוצרים מוכנים לאכילה: 2.6 (✓ правильно заменено)
✅ לקוח: איסגוב שותפות (✓ сохранено)
✅ כתובת: הנביאים 3 (✓ сохранено)
✅ תאריך: 05.08.25 (✓ сохранено)
```

### 1. Проверьте структуру промежуточного файла:
```powershell
python debug_file_structure.py your_intermediate_file.xlsx
```

### 2. Убедитесь, что промежуточный файл содержит столбцы:
- `ח"פ לקוח או מספר עוסק` (номера лицензий)
- `אסמכתת בסיס` (базовая ссылка) 
- `סה'כ אריזות` (количество упаковок)
- `סה'כ משקל` (общий вес)

### 3. Тест с реальными данными:
```powershell
python test_real_data.py
```

### 4. Диагностика проблем:
```powershell
python diagnose_issue.py
```

### 5. Интерактивная отладка (если проблемы остаются):
```powershell
python interactive_debug.py
```
Этот скрипт проведет пошаговую диагностику вашего случая.

## 🎯 Результат: Система работает правильно!

**✅ ИСПРАВЛЕНО**: Копирование с одновременной заменой данных работает корректно!

**Процесс работы:**
1. 🔍 Поиск отчетов по номеру лицензии из промежуточного файла
2. 📋 Создание копии отчета в специальной директории  
3. 🔄 **ОДНОВРЕМЕННАЯ замена данных при копировании**

**✅ Тестирование подтвердило корректную работу:**
```
✅ אסמכתת בסיס → מספר תעודת משלוח (223931)
✅ סה'כ אריזות → סה"כ קרטונים (0.6)
✅ סה'כ משקל → מוצרים מוכנים לאכילה (2.6)
```

**Автоматическая замена полей работает при копировании:**
- **אסמכתת בסיס** → **מספר תעודת משלוח**  
- **סה'כ אריזות** → **סה"כ קרטונים**
- **סה'כ משקל** → **מוצרים מוכנים לאכילה**

**🔧 Техническое исправление:**
Решена проблема с конвертацией номеров лицензий при чтении Excel файлов (pandas добавлял `.0` к номерам).

## Для тестирования:

### Полный тест workflow:
```powershell
python test_full_workflow.py
```

### Тест группировки:
```powershell
python test_grouping.py
```

### Создание тестовых данных:
```powershell
python create_sample_data.py
```

## ⚠️ Важно!

В PowerShell используйте `;` вместо `&&` для разделения команд:
- ❌ `cd src && python -m fish_reports`
- ✅ `cd src ; python -m fish_reports`

---
*Готово к запуску!* 🎯
